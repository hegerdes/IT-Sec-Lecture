\documentclass[12pt, a4paper]{scrartcl}

\include{inc/packages.inc}
\include{inc/personalize.inc}
\include{inc/style.inc}

\begin{document}

\pagenumbering{gobble}
\include{inc/title.inc}

\tableofcontents
\newpage
\newcounter{lastroman}
\setcounter{lastroman}{\value{page}}

\pagestyle{plain}
\pagenumbering{arabic}
\maketitle

\section{Introduction}
Part of the IT security lecture was to create a proxy client-server system that redirects TCP connections to bypass filter rules of firewalls and hide personal informational of the clients. The structure is displayed in fig \ref{fig::arch}. \newline
Server and client both use a common tunneling class. It is based of a \textit{SocketServer.TCPServer}, which already handles the underlaying socket connection and does not block. Each base-tunnel instance can have a custom handler that implements the required logic and gets called every request. These handlers handle the initial handshake between client and server Server and on success switches to redirect mode. Both, server and client can handle multible requests at the same time.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\linewidth]{entities.jpg}
    \caption{Netzwerk-Architektur to bypass a firewall}
    \label{fig::arch}
\end{figure}

\newpage
\section{Security}
At the end of task 1 the proxy system parses a configuration file, accepts multiple requests at a time and in general is fully functional. Nerveless it still lacks some basic requirements in terms of security and availability. The following section discusses these and all involved entities.

\subsection{Entities}
The following entities are involved by using the proxy:
\begin{figure}[H]
    \centering
    \begin{subfigure}{0.45\textwidth}
        \begin{itemize}
            \item User:
            \begin{itemize}
                \item Application
                \item ProxyClient
            \end{itemize}
            \item Proxy-Provider
            \begin{itemize}
                \item ProxyServer
            \end{itemize}
            \item Content-Providers
            \begin{itemize}
                \item E-Mail
                \item WebServices
                \item PrivateServices
                \item \ldots
            \end{itemize}
        \end{itemize}
    \end{subfigure}
    \begin{subfigure}{0.5\textwidth}
        \centering
        \includegraphics[width=\linewidth]{structure.png}
        \caption{PlACEHOLDER}
        \label{fig::enti}
    \end{subfigure}
\end{figure}

\noindent The following section discusses the relation between these entities as well as the security risks that exists in-between them.
\subsection{Security risks and restrictions}
\paragraph{User \& ProxyProvider:}\label{ssec::user}
\noindent Any internet connected device can perform requests to the proxy. The server can not be sure that the client that connects is indeed a valid client instead of a malicious client that spoofs its identity. The same problem persists on the client side. Attackers may fake the proxy client and convince users to connect to their server and perform further malicious actions. There is no way the entities can be sure about each others identity and thereby it violates the principle of \textbf{Authentication}.\newline
Some parts of the communication infrastructure are owned by third party entities. Every one that has access to a part of the communication infrastructure can capture all confidential information on that infrastructure and use it against the recipient. This violates the principle of \textbf{Confidentiality}.\newline
Beside capturing information it is also possible to alter the information wich violates the principle of \textbf{Integrity}.
\paragraph{ProxyProvider \& Content-Providers:}
Der ProxyServer Anbieter ermöglicht es fremden Entitäten seine Dienste zu nutzen, sowie durch diese fremden Entitäten Anfragen an Dritte zu richten. Dabei trägt der Server Anbieter die Verantwortung für Angriffe oder andere illegale Handlungen, die über seine Infrastruktur gegenüber Dritte getätigt werden.\newline
Auch die eigene Infrastruktur kann Ziel eines Angriffs werden, indem z.B. Angreifer so viele Anfragen an der Proxy stellen, dass dieser zusammenbricht und nicht mehr durch andere genutzt werden kann, wie bei einem klassischen \ac{DoS} angriff.
\paragraph{User \& Content-Providers:}
Wie oben in \ref{ssec::user} bereits erwähnt, ist das Prinzip der Vertraulichkeit bei der aktuellen Konfiguration zwischen keinen der Entitäten gegeben. Technisch ist dies dadurch bedingt, dass der Proxy zu diesem Zeitpunkt keine sockets unterstützt, die das \ac{TLS}-Protokoll für TCP Verbindungen nutzen. Aufgrund dessen schlägt die Authentifizierung, sowie der Schlüsselaustausch für nachfolgende Verschlüsselung mit dem WebServers gegenüber des Proxys und somit auch der Anwendung (Browser) fehl. Anwendungen sind somit auf nicht verschlüsselte Dienste, wie \acs{HTTP} beschränkt.
\subsection{Lösungsansetze}
\paragraph{Vertraulichkeit, Integrität und Authentizität}
Damit Anwender sich sicher sein können, dass sie sich mit einem vertrauenswürdigen ProxyServer verbinden, kann man eine Server Authentifizierung einführen, bei der sich der Server mit einem Zertifikat ausweist und der Client dieses Zertifikat Zertifikat überprüft. Dies löst das Problem der \textbf{Authentication} des Servers gegenüber des Clients. Gleiches kann der Client gegenüber dem Servers machen. Organisatorisch wäre dafür notwendig, dass der Server alle CA-Zertifikate besitzt, mit denen die Clients signiert wurden, was in der realen Welt eine unvorstellbare logistische Herausforderung bedeuten würde.\newline
Technisch gesehen würden diese Zertifikate während des \ac{TLS}-Handshakes ausgetauscht werden. Ebenfalls möglich ist es mittels \ac{TLS} Nachrichten zu verschlüsseln, um dessen \textbf{Confidentiality} sicherzustellen. Die genauen Verschlüsselungsverfahren hängen von der genutzten Version und Erweiterungen von \ac{TLS} ab.\newline
Um die \textbf{Integrity} einer Nachricht sicherzustellen wird über die Nachricht ein Hash berechnet, anschließend ebenfalls verschlüsselt und als Signatur angehängt. Der Empfänger kann den selbst berechneten Hash mit dem entschlüsseltem Hash aus der Signatur vergleichen, um dessen Integrität zu überprüfen.\newline
Die technische Umsetzung ist mit dem \code{ssl}-Modul möglich, welches das \ac{TLS}-Protokoll vollständig implementiert.
\paragraph{Verfügbarkeit und Missbrauchsschutz}
Neben der Sicherheit der Kommunikation ist auch die Verfügbarkeit, sowie die Nutzung des Proxys für ausschließlich legale Zwecke sicherzustellen. Dies kann eben einer Eingrenzung der Nutzer durch Filter gewährleistet werden, die bestimme Dienste blockieren und Ressourcen wie Datennutzung, Anzahl der Anfragen und Rechenleistung limitieren. Loadbalancer und Backup-Systeme würden die Verfügbarkeit zusätzlich steigern.

\section{Evaluation}
Im Rahmen dieser Evaluation wird nur der Datendurchsatz des Proxys betrachtet, andere Metriken wie Delay und Paketverlust werden vernachlässigt.
\subsection{Testaufbau}
\begin{figure}
    \centering
    \includegraphics[width=0.45\linewidth]{TestSetup.png}
    \caption{Bandbreiten Testaufbau}
    \label{fig::test}
\end{figure}
Für die Durchführung der Durchsatzmessungen wurde auf das Werkzeug \code{iperf} zurückgegriffen. Dieses erlaubt es mittels einer Client-Server Architektur den Datendurchsatz zwischen Endpunkten zu bestimmen.\newline
Alle Rechner (Client(Vogon), TestServer1(diggory), TestServer2(bones)) werden mit KaliLinux betrieben und nutzen Version 2.0.14a von \code{iperf} auf dem Client und Version 2.0.5 auf dem Server. Abseits der standard Konfiguration wurde auf die einheitliche Testdauer von 10s verzichtet und stattdessen eine Datenmenge von 16MB für die Übertragung festgelegt. So kann z.B. einfach die Übertragungsdauer bestimmter WebSeiten abschätzen werden. Aufgrund des natürlichen Einschätzungsvermögen für Zeit sind die Ergebnisse so auch für Leser ohne technischem Hintergrund einfacher einzuschätzen. Zusätzlich wurde das Logging-interval auf 0.5s gesetzt um genauer Intervalle extrahieren zu können. Es wurde nur der Download vom Server gemessen, ein bidirektionaler Test war Aufgrund der nicht öffentlich zugänglichen IP des Clients nicht möglich.\newline
Als Basisfall wurde ein direkte Messung ohne Proxy zu einem der System diggory durchgeführt. Um einem realistischem Einsatz zu simulieren, wurde anschließend der ProxyServer auf dem zweitem Testrechner (bones) gestartet, welcher dann eine Verbindung zur iperf Instanz auf diggory herstellt. So erhält man eine Topologie von drei Rechnern, dem Client, der ProxyServer und der Zielserver, wie sie auch in der Realität anzufinden wäre.\newline
Der ProxyServer wurde dann in den Konfiguration KeinSSL, ServerAuthentification, ClientServerAthentification und ClientServerAthentificationACL getestet. Ein Testlauf besteht aus 15 Iterationen über diese Konfigurationen. Insgesamt wurden 4 Testläufe zu unterschiedlichen Uhrzeiten, alle neun Stunden, durchgeführt. Ein automatisiertes Script befindet sich im Anhang.
\subsection{Analyse der Ergebnisse}
Die generierten Log-Dateien wurden mit dem beiliegendem Script ausgelesen und erzeugen alle nachfolgenden Grafiken.
\subsection{Fazit}

% Anhang
\newpage
\renewcommand{\thesubsection}{\Alph{subsection}}
\pagenumbering{Roman}
\setcounter{page}{\value{lastroman}}
\section*{Appendix}
\addcontentsline{toc}{section}{Appendix}
%Abkürzungsverzeichnis
\input{inc/shorts.inc}
\include{inc/ensure.inc}
\end{document}
